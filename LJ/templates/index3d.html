<html>

<head>
  <meta http-equiv="X-UA-Compatible" content="chrome=1" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <title> Test </title>
  <!-- CSS -->

  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" type="text/css" href="http://www.x3dom.org/download/dev/x3dom.css"/>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <link rel="stylesheet" href="/static/css/style.css">

  <!-- JS -->
  <script src="/static/js/lib/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="http://d3js.org/d3.v4.min.js"></script>
  <script src="/static/js/script.js"></script>
  <script src="/static/js/d3-tip.js"></script>
  <script src="/static/js/d3-x3dom-axis.min.js"></script>
  <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3-legend/2.25.5/d3-legend.js"></script>
  <script type="text/javascript" src="http://x3dom.org/x3dom/dist/x3dom-full.js"></script>

<style>

</style>
</head>

<body>
  <div id="left">
    <div id="plot">Click on run to continue.</div>
  </div>
  <div id="right">
    <div>
      <h4>
        Tuning Parameters
      </h4>
    </div>
    <form action="/submit3d" method="POST">
      <h6>Experiment params</h6>
      <input type="text" class="form-control" rows="5" name="time_end" placeholder="N_Iteration(default:3000)"></input>
      <input type="text" class="form-control" rows="5" name="print_every" placeholder="print_every(default:100)" id="print_every"></input>
      <input type="text" class="form-control" rows="5" name="dt" placeholder="dt(default:0.0005)" id="dt"></input>
      <input type="text" class="form-control" rows="5" name="num_particle" placeholder="num_particle(default:100)" id="num_particle"></input>
      <h6>LJ Force Param</h6>
      <input type="text" class="form-control" rows="5" name="epsilon" placeholder="epsilon(default:5)" id="epsilon"></input>
      <input type="text" class="form-control" rows="5" name="ljcutoff" placeholder="cutoff(default:2.5)" id="ljcutoff"></input>
      <h6>Spring params</h6>
      <input type="text" class="form-control" rows="5" name="k" placeholder="k(default:0.05)" id="k"></input>
      <input type="text" class="form-control" rows="5" name="r0" placeholder="r0(default:1.12)" id="r0"></input>
      <div class="form-check">
          <input type="checkbox" class="form-check-input" id="springDisplay" value="true" checked>
      <label class="form-check-label" for="exampleCheck1">Visualize spring Forces</label>
      </div>
      <h6>Displacement params</h6>
      <input type="text" class="form-control" rows="5" name="moveafter" placeholder="move_after(default:500)" id="k"></input>
      <input type="text" class="form-control" rows="5" name="moveevery" placeholder="move_every(default:20)" id="r0"></input>
      <input type="text" class="form-control" rows="5" name="movedisplacement" placeholder="move_displacement(default:1.5)" id="r0"></input>
      <input type="submit" class="btn btn-primary" name="my-form" value="Run">
    </form>
  </div>

  <script>
  d3.select('html').style('height','100%').style('width','100%')
  d3.select('body').style('height','100%').style('width','100%')
  // d3.select('#plot').style('width', "500px").style('height', "500px")
    var iteration = -100;
    var increment_iter = {{iter_inc}};
    var dt = 0.0005;
    // Set tooltips
var tip1 = d3.tip()
  .attr('class', 'd3-tip')
  .offset([100, 0])
  .html(function(d) {
    return "<strong>X: </strong><span class='details'>" + d.x + "</span><br /><strong>Y: </strong><span class='details'>" + d.y + "</span><br /><strong>P: </strong><span class='details'>" + d.z + "</span>";
  });

    // alert({{v_spring}});
  </script>
  {% for d in data: %}
  <script>
    // $("#data").text("{{d}}");
    var str = "{{d}}";
    var res = str.replace(/&#34;/g, "\"");
    // console.log(res);
    iteration = iteration + increment_iter;
    console.log("Iteration number : " + iteration);
   var parsed_res = JSON.parse(res)
   // scatterPlot3d(parsed_res, d3.select('#plot'));
    // $("#data").text(JSON.parse(res));
    // console.log(parsed_res[0]);
    scatterPlot3d();

    function scatterPlot3d()
    {

    var makeSolid =  function(selection, color) {
      selection.append("appearance").append("material").attr("diffuseColor", color || 	"black");
      return selection;
    }

    var width = 800, height = 400;
    $("#plot").empty();
    var x3d = d3.select("#plot").append("x3d")
      .attr("width", width + 'px')
      .attr("height", height +'px' );
    d3.select('.x3dom-canvas')
      .attr("width", 2 * width)
      .attr("height", 2 *  height);


    var x = d3.scaleLinear().range([0, 40]);
    var y = d3.scaleLinear().domain([0, 4]).range([0, 40]);
    var z = d3.scaleLinear().range([0, 40]);
    var xAxis = d3_x3dom_axis.x3domAxis('x', 'z', x).tickSize(z.range()[1] - z.range()[0]).tickPadding(y.range()[0]);;
    var yAxis = d3_x3dom_axis.x3domAxis('y', 'z', y).tickSize(z.range()[1] - z.range()[0]);
    var yAxis2 = d3_x3dom_axis.x3domAxis('y', 'x', y).tickSize(x.range()[1] - x.range()[0]).tickFormat(function(d){return ''});
    var zAxis = d3_x3dom_axis.x3domAxis('z', 'x', y).tickSize(x.range()[1] - x.range()[0]);


    var scene = x3d.append("scene");
    var view_pos = [80, 25, 80];
    var fov = 0.8;
    var view_or = [0, 1, 0, 0.8];
    scene.append("viewpoint")
      .attr("position", view_pos.join(" "))
      .attr("orientation", view_or.join(" "))
      .attr("fieldOfView", fov);

    scene.append('group')
      .attr('class', 'xAxis')
      .call(xAxis)
      .select('.domain').call(makeSolid, 'blue');
    scene.append('group')
      .attr('class', 'yAxis')
      .call(yAxis)
      .select('.domain').call(makeSolid, 'red');
    scene.append('group')
      .attr('class', 'yAxis')
      .call(yAxis2)
      .select('.domain').call(makeSolid, 'red');
    scene.append('group')
      .attr('class', 'zAxis')
      .call(zAxis)
      .select('.domain');

    var n = 40;
    var points = d3.range(n).map(function(d) {
      var p = {};
      p.x = Math.random();
      p.z = Math.random();
      p.y = 2 * p.x + p.z + Math.random();
      return p;
    })

    scene.selectAll('.point')
      .data(points)
      .enter()
      .append('transform')
      .attr('class', 'point')
      .attr('translation', function(d){ return x(d.x) + ' ' + y(d.y) + ' ' + z(d.z)})
      .append('shape')
      .call(makeSolid, 'red')
      .append('sphere')
      .attr('radius', 0.5);
}


  </script>
  {% endfor %}
</body>



</html>
